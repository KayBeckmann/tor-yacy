services:
  tor:
    build: ./tor
    restart: unless-stopped
    volumes:
      - ./hidden_service:/var/lib/tor/hidden_service
    environment:
      - VANITY_PREFIX=${VANITY_PREFIX:-}
      - YACY_HOST=yacy
      - YACY_PORT=8090
      - ONION_PORT=${ONION_PORT:-80}
      - PEER_PORT=${PEER_PORT:-8090}
    networks:
      - tor-net

  yacy:
    build: ./yacy
    restart: unless-stopped
    volumes:
      - ./yacy-data:/opt/yacy_search_server/DATA
      - ./hidden_service:/hidden_service:ro
    environment:
      - YACY_PROXY_HOST=tor
      - YACY_PROXY_PORT=8118
      - BOOTSTRAP_PEER=${BOOTSTRAP_PEER:-}
      - NETWORK_NAME=${NETWORK_NAME:-tor}
      - PEER_PORT=${PEER_PORT:-8090}
      - YACY_ADMIN_USER=${YACY_ADMIN_USER:-admin}
      - YACY_ADMIN_PASSWORD=${YACY_ADMIN_PASSWORD:-}
    depends_on:
      - tor
    networks:
      - tor-net
    ports:
      - "${YACY_LOCAL_PORT:-8090}:8090"

networks:
  tor-net:
    driver: bridge
